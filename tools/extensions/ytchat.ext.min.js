if(window.opener&&window.opener!==window){window.open(window.location.href,"_blank");window.close()}function getUrlParameter(sParam){var sPageURL=window.location.search.substring(1),sURLVariables=sPageURL.split("&"),sParameterName,i;for(i=0;i<sURLVariables.length;i++){sParameterName=sURLVariables[i].split("=");if(sParameterName[0]===sParam){return typeof sParameterName[1]===undefined?true:decodeURIComponent(sParameterName[1])}}return false}function selectOnInsertion(containerSelector,tag,callback){var insertionObserver=function(mutations){mutations.forEach(function(mutation){if(mutation.addedNodes.length){for(var i=0,len=mutation.addedNodes.length;i<len;i++){if(mutation.addedNodes[i].tagName===tag.toUpperCase()){callback(mutation.addedNodes[i])}}}})};var target=document.querySelectorAll(containerSelector)[0];var config={childList:true,subtree:true};var MutationObserver=window.MutationObserver||window.WebKitMutationObserver;var observer=new MutationObserver(insertionObserver);observer.observe(target,config)}function openFullscreen(element){if(element.requestFullscreen){element.requestFullscreen()}else if(elem.webkitRequestFullscreen){element.webkitRequestFullscreen()}else if(element.msRequestFullscreen){element.msRequestFullscreen()}}function closeFullscreen(){if(document.exitFullscreen){document.exitFullscreen()}else if(document.webkitExitFullscreen){document.webkitExitFullscreen()}else if(document.msExitFullscreen){document.msExitFullscreen()}}function toggleFullscreen(fullscreen){var element=document.documentElement;fullscreen?openFullscreen(element):closeFullscreen()}function navigate(link){window.open(link,"_blank")}function declutter(){$("#contents yt-live-chat-poll-renderer").addClass("avidcaster-hide");$("#visible-banners yt-live-chat-banner-header-renderer").closest("#visible-banners").addClass("avidcaster-hide");$("#card.yt-live-chat-viewer-engagement-message-renderer").closest("#card").addClass("avidcaster-hide");$("#container .yt-live-chat-restricted-participation-renderer").closest("#input-panel").addClass("avidcaster-hide");$("#container .yt-live-chat-message-input-renderer").closest("#input-panel").addClass("avidcaster-hide")}function reclutter(){$("#contents yt-live-chat-poll-renderer").removeClass("avidcaster-hide");$("#visible-banners yt-live-chat-banner-header-renderer").closest("#visible-banners").removeClass("avidcaster-hide");$("#card.yt-live-chat-viewer-engagement-message-renderer").closest("#card").removeClass("avidcaster-hide");$("#container .yt-live-chat-restricted-participation-renderer").closest("#input-panel").removeClass("avidcaster-hide");$("#container .yt-live-chat-message-input-renderer").closest("#input-panel").removeClass("avidcaster-hide")}function getAuthorName(element){element.find("#author-name #tooltip.hidden").remove();var authorName=element.find("#author-name").text();return authorName}function getAuthorImage(element){var authorImage=element.find("#img").attr("src").replace("s32","s256").replace("s64","s256");return authorImage}function getAuthorBadge(element){var authorBadge=element.find("#chat-badges .yt-live-chat-author-badge-renderer img").attr("src");return authorBadge}function getMessage(element){element.find("#message hidden").remove();element.find("#message font").contents().unwrap();element.find("#message").children().not("img").remove();element.find("#message").children().removeClass();var message=element.find("#message").html();return message}function getDonationAmount(element){var donationAmount=element.find("#purchase-amount").text();if(!donationAmount){donationAmount=element.find("#purchase-amount-chip").text()}return donationAmount?.replace(/\s\s+/g," ").trim()}function postMessageSouthBound(data){data={type:"avidcaster-overlay-south-bound",action:"yt-chat",payload:data};document.getElementById("avidcaster-iframe").contentWindow.postMessage(data,"*")}var clickable=["yt-live-chat-text-message-renderer","yt-live-chat-paid-message-renderer","yt-live-chat-membership-item-renderer","yt-live-chat-paid-sticker-renderer"];var highlightedWords=[];if(window.opener&&window.opener!==window){window.open(window.location.href,"_blank");window.close()}var isProd=getUrlParameter("prod")==="false"?false:true;var targetSite=isProd?"avidcaster.net":"avidcaster.dev:80/";$("yt-live-chat-app").append('<iframe id="avidcaster-iframe" src="https://'+targetSite+'/ytchat/overlay"></iframe>');$("body").off("click").on("click",clickable.join(","),function(){if($(this)[0].hasAttribute("is-deleted")){$(this).addClass("avidcaster-deleted");return}$(this).addClass("avidcaster-dispatched");$(this).find("yt-live-chat-paid-message-renderer").addClass("avidcaster-dispatched");var clicked=$(this).clone();var data={message:"",authorName:"",authorImage:"",donation:""};data.authorName=getAuthorName(clicked);data.authorImage=getAuthorImage(clicked);data.authorBadge=getAuthorBadge(clicked);data.message=getMessage(clicked);data.donation=getDonationAmount(clicked);postMessageSouthBound(data)});window.addEventListener("message",event=>{if(event.data.type==="avidcaster-overlay-north-bound"){switch(event.data.action){case"navigate":navigate(event.data.payload.url);break;case"fullscreen":toggleFullscreen(event.data.payload.fullscreen);break;case"declutter":declutter();break;case"reclutter":reclutter();break;case"highlight-words":highlightedWords=(event.data.payload.words||[]).map(word=>word.trim().toLowerCase()).filter(word=>word.length>0);default:break}}},false);selectOnInsertion(".yt-live-chat-item-list-renderer#items","yt-live-chat-text-message-renderer",function(element){var chatWords=$(element).find("#message").text().toLowerCase().replace(/\s\s+/g," ").trim().split(" ");var highlights=chatWords.filter(value=>highlightedWords.includes(value));if(highlights.length>0){$(element).addClass("avidcaster-highlighted")}});